<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²¬ì ì„œ ì¶œë ¥ - ê±´ì„¤ê´€ë¦¬ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1e71f6",
                        "background-light": "#f5f7f8",
                        "background-dark": "#101722",
                    },
                    fontFamily: {
                        "display": ["Inter"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-break {
                page-break-before: always;
            }
            
            /* ì¸ì‡„ ì‹œ í˜ì´ì§€ ì„¤ì • */
            @page {
                size: A4;
                /* ìƒ:4mm, ìš°/í•˜/ì¢Œ:8mm */
                margin: 4mm 8mm 8mm 8mm;
            }
            /* í—¤ë” ìƒë‹¨ íŒ¨ë”©ì„ ë” ì¤„ì—¬ ìƒë‹¨ ì—¬ë°± ìµœì†Œí™” */
            #q-header { padding-top: 6mm !important; }
            
            /* ì¸ì‡„ ì‹œ ë°°ê²½ìƒ‰ í‘œì‹œ */
            body {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* ì¸ì‡„ ì‹œ ê·¸ë¦¼ì ì œê±° */
            .shadow-xl, .shadow-lg, .shadow-md {
                box-shadow: none !important;
            }
            
            /* ì¸ì‡„ ì‹œ ì—¬ë°± ì¡°ì • */
            .max-w-4xl {
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            /* ì¸ì‡„ ì‹œ ë‘¥ê·¼ ëª¨ì„œë¦¬ ì œê±° */
            .rounded-xl, .rounded-lg {
                border-radius: 0 !important;
            }
            
            /* í…Œì´ë¸” í˜ì´ì§€ ë¶„í•  ë°©ì§€ */
            table, tr, td, th {
                page-break-inside: avoid;
            }
        }
        
        /* ì¸ì‡„ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ê°œì„  */
        .print-button {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .print-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .print-button:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
    <!-- ì¸ì‡„/ë‹«ê¸° ë²„íŠ¼ -->
    <div class="no-print max-w-4xl mx-auto p-4 flex justify-end items-center gap-3">
        <button onclick="handlePrint()" class="print-button bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
            ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°
        </button>
        <button onclick="window.close()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
            âœ• ë‹«ê¸°
        </button>
    </div>

    <div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="bg-white dark:bg-gray-900 shadow-xl rounded-xl">
            <!-- í—¤ë” -->
            <header id="q-header" class="p-6 border-b border-gray-200 dark:border-gray-700/50 relative overflow-hidden">
                <div class="absolute -top-16 -left-16 w-48 h-48 bg-primary/10 dark:bg-primary/20 rounded-full"></div>
                <div class="absolute -bottom-24 -right-12 w-48 h-48 bg-primary/10 dark:bg-primary/20 rounded-full transform rotate-45"></div>
                <div class="relative z-10 flex justify-between items-start">
                    <div>
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 bg-primary rounded-lg flex items-center justify-center">
                                <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h6m-6 4h6m-6 4h6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                </svg>
                            </div>
                            <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Buildify</h1>
                        </div>
                        <h2 class="mt-4 text-4xl sm:text-5xl font-extrabold text-primary tracking-tight">ê²¬ì ì„œ (Quotation)</h2>
                        <p class="mt-2 text-gray-500 dark:text-gray-400">Quotation ID: <span id="quotationId">#Q2025-00123</span></p>
                        <p class="text-gray-500 dark:text-gray-400">Date: <span id="issueDate">2025ë…„ 9ì›” 28ì¼</span></p>
                    </div>
                </div>
            </header>

            <section class="grid md:grid-cols-2 gap-3 p-4">
                <div class="bg-background-light dark:bg-background-dark p-4 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 border-b-2 border-primary pb-1">ë°œì£¼ì²˜ ì •ë³´ (Client Information)</h3>
                    <div class="space-y-1.5 text-sm leading-5">
                        <p><strong>ê±´ì¶•ì£¼ëª…:</strong> <span id="clientCompany">ê¹€ì² ìˆ˜</span></p>
                        <p><strong>í”„ë¡œì íŠ¸ëª…:</strong> <span id="clientProject">í”„ë¡œì íŠ¸</span></p>
                        <p><strong>ì‘ì—…ì¥ ì£¼ì†Œ:</strong> <span id="clientWorkplaceAddress">ì„œìš¸íŠ¹ë³„ì‹œ ...</span></p>
                    </div>
                </div>
                <div class="bg-background-light dark:bg-background-dark p-4 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3 border-b-2 border-primary pb-1">ì‹œê³µì—…ì²´ ì •ë³´ (Contractor Information)</h3>
                    <div class="space-y-1.5 text-sm leading-5">
                        <p><strong>ì—…ì²´ëª…:</strong> <span id="contractorCompany">í•œêµ­ê±´ì„¤(ì£¼)</span></p>
                        <p><strong>ëŒ€í‘œì:</strong> <span id="contractorContact">í™ê¸¸ë™</span></p>
                        <p><strong>ì´ë©”ì¼:</strong> <span id="contractorEmail">hong@hanbuilding.com</span></p>
                        <p><strong>ì—°ë½ì²˜:</strong> <span id="contractorPhone">02-1234-5678</span></p>
                    </div>
                </div>
            </section>

            <section class="p-6">
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">ê²¬ì  ë‚´ì—­ (Quotation Details)</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left table-fixed">
                        <thead class="bg-gray-100 dark:bg-gray-800 text-sm">
                            <tr>
                                <th class="w-16 p-2 font-semibold text-gray-700 dark:text-gray-300 text-center">ìˆœë²ˆ</th>
                                <th class="w-20 p-2 font-semibold text-gray-700 dark:text-gray-300 text-center">êµ¬ë¶„</th>
                                <th class="w-1/2 p-2 font-semibold text-gray-700 dark:text-gray-300 text-center">ë‚´&nbsp;&nbsp;&nbsp;&nbsp;ìš©</th>
                                <th class="w-16 p-2 font-semibold text-gray-700 dark:text-gray-300 text-center">ìˆ˜ëŸ‰</th>
                                <th class="w-16 p-2 font-semibold text-gray-700 dark:text-gray-300 text-center">ë‹¨ìœ„</th>
                                <th class="w-24 p-2 font-semibold text-gray-700 dark:text-gray-300 text-right">ë‹¨ê°€ (ì²œì›)</th>
                                <th class="w-24 p-2 font-semibold text-gray-700 dark:text-gray-300 text-right">ê¸ˆì•¡ (ì²œì›)</th>
                                <th class="w-20 p-2 font-semibold text-gray-700 dark:text-gray-300 text-center">ë¹„ê³ </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 dark:divide-gray-700/50 text-sm" id="quotationItems">
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                                <td class="p-2 text-center">1</td>
                                <td class="p-2 text-center font-medium">í† ëª©ê³µì‚¬</td>
                                <td class="p-2">í„°íŒŒê¸° ë° ì§€ë°˜ ì‘ì—…</td>
                                <td class="p-2 text-center">1</td>
                                <td class="p-2 text-center">ì‹</td>
                                <td class="p-2 text-right font-mono">30,000</td>
                                <td class="p-2 text-right font-mono font-medium text-primary">30,000</td>
                                <td class="p-2 text-center text-xs text-gray-500 dark:text-gray-400">ì½˜í¬ë¦¬íŠ¸ ê°•ë„ í™•ì¸ í•„ìš”</td>
                            </tr>
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                                <td class="p-2 text-center">2</td>
                                <td class="p-2 text-center font-medium">êµ¬ì¡°ê³µì‚¬</td>
                                <td class="p-2">ì² ê³¨ ë° ì² ê·¼ì½˜í¬ë¦¬íŠ¸ ê³¨ì¡° ì‘ì—…</td>
                                <td class="p-2 text-center">1</td>
                                <td class="p-2 text-center">ì‹</td>
                                <td class="p-2 text-right font-mono">40,000</td>
                                <td class="p-2 text-right font-mono font-medium text-primary">40,000</td>
                                <td class="p-2 text-center text-xs text-gray-500 dark:text-gray-400">ì² ê·¼ ê°„ê²© ì ì •ì„± ê²€í†  í•„ìš”</td>
                            </tr>
                            <tr class="hover:bg-gray-50 dark:hover:bg-gray-800/50">
                                <td class="p-2 text-center">3</td>
                                <td class="p-2 text-center font-medium">ë§ˆê°ê³µì‚¬</td>
                                <td class="p-2">ë‚´ë¶€ ë° ì™¸ë¶€ ë§ˆê°ì¬ ì‹œê³µ</td>
                                <td class="p-2 text-center">1</td>
                                <td class="p-2 text-center">ì‹</td>
                                <td class="p-2 text-right font-mono">15,000</td>
                                <td class="p-2 text-right font-mono font-medium text-primary">15,000</td>
                                <td class="p-2 text-center text-xs text-gray-500 dark:text-gray-400">ê³ ê¸‰ ë§ˆê°ì¬ ì ìš©</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="p-6 grid md:grid-cols-2 gap-4 bg-gray-50 dark:bg-gray-800/50">
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">íŠ¹ì´ì‚¬í•­ ë° ì¡°ê±´</h3>
                    
                    
                    <div id="specialConditions" class="text-xs text-gray-600 dark:text-gray-300 space-y-1">
                        <!-- íŠ¹ì´ì‚¬í•­ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div class="flex flex-col items-end">
                    <div class="w-full max-w-sm space-y-2 bg-white dark:bg-gray-900 p-4 rounded-lg shadow-md text-sm">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 dark:text-gray-300">ì†Œê³„</span>
                            <span id="subtotal" class="font-mono font-medium">â‚©0ì›</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 dark:text-gray-300">ë¶€ê°€ì„¸ (10%)</span>
                            <span id="vat" class="font-mono font-medium">â‚©0ì›</span>
                        </div>
                        <div class="border-t border-gray-300 dark:border-gray-600 my-2"></div>
                        <div class="flex justify-between items-center font-bold text-lg text-primary">
                            <span>ì´ ê²¬ì ê¸ˆì•¡</span>
                            <span id="totalAmount" class="font-mono">â‚©0ì›</span>
                        </div>
                        <p class="text-base text-gray-500 dark:text-gray-400 text-right mt-2">
                            (êµ¬ì²œì‚¼ë°±ì˜¤ì‹­ë§Œì›ì •)
                        </p>
                    </div>
                </div>
            </section>

            <footer class="p-6 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700/50">
                <p>ê°ì‚¬í•©ë‹ˆë‹¤.</p>
                <p id="footerCompany">íšŒì‚¬ëª… Â© <span id="footerYear"></span></p>
            </footer>
        </div>
    </div>

    <script>
        function parseFromLocalStorage(){
          try{
            const raw = localStorage.getItem('quotationPrintData');
            if(!raw) return null;
            return JSON.parse(raw);
          }catch(e){ console.warn('ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê²¬ì  ë°ì´í„° íŒŒì‹± ì‹¤íŒ¨', e); return null; }
        }
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ê²¬ì  ë°ì´í„° ë¡œë“œ
        function loadQuotationFromUrl() {
          const urlParams = new URLSearchParams(window.location.search);
          const estimateData = urlParams.get('data');
            
            console.log('=== ê²¬ì ì„œ ì¶œë ¥ í˜ì´ì§€ ë¡œë“œ ì‹œì‘ ===');
            console.log('URL ì „ì²´:', window.location.href);
            console.log('URL íŒŒë¼ë¯¸í„° ì „ì²´:', window.location.search);
            console.log('estimateData (ì¸ì½”ë”©ë¨):', estimateData);
            
            if (estimateData) {
                try {
                    // ë¨¼ì € JSON íŒŒì‹±ì„ ì§ì ‘ ì‹œë„
                    let estimate;
                    try {
                        console.log('JSON ì§ì ‘ íŒŒì‹± ì‹œë„');
                        estimate = JSON.parse(estimateData);
                        console.log('JSON ì§ì ‘ íŒŒì‹± ì„±ê³µ');
                    } catch (directParseError) {
                        console.log('JSON ì§ì ‘ íŒŒì‹± ì‹¤íŒ¨, ë””ì½”ë”© í›„ ì¬ì‹œë„');
                        const decodedData = decodeURIComponent(estimateData);
                        console.log('estimateData (ë””ì½”ë”©ë¨):', decodedData);
                        estimate = JSON.parse(decodedData);
                        console.log('ë””ì½”ë”© í›„ íŒŒì‹± ì„±ê³µ');
                    }
                    
                    console.log('íŒŒì‹±ëœ ê²¬ì  ë°ì´í„°:', estimate);
                    loadQuotationData(estimate);
                } catch (error) {
                    console.error('ê²¬ì  ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:', error);
                    console.error('ì›ë³¸ ë°ì´í„°:', estimateData);
                }
            } else {
                console.log('ê²¬ì  ë°ì´í„°ê°€ URL íŒŒë¼ë¯¸í„°ì— ì—†ìŠµë‹ˆë‹¤. localStorageì—ì„œ ë¡œë“œ ì‹œë„');
                const ls = parseFromLocalStorage();
                if (ls) { loadQuotationData(ls); }
            }
        }
        
        // ê²¬ì ì„œ ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
        function loadQuotationData(payload) {
            if (!payload) return;
            const estimate = payload.estimate || payload;
            const company = payload.companyInfo || {};
            
            // ë””ë²„ê¹…: ì „ë‹¬ë°›ì€ ê²¬ì  ë°ì´í„° í™•ì¸
            console.log('ê²¬ì  ë°ì´í„°:', estimate);
            console.log('íŠ¹ì´ì‚¬í•­ ë° ì¡°ê±´ (notes):', estimate.notes);
            
            // í—¤ë” ì •ë³´
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            const day = currentDate.getDate();
            const koreanDate = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            
            document.getElementById('quotationId').textContent = estimate.id || `#Q${year}-00123`;
            document.getElementById('issueDate').textContent = estimate.date || koreanDate;
            // í‘¸í„° íšŒì‚¬ëª…/ì—°ë„
            const footerName = (company && company.name) ? company.name : (estimate.companyName || '');
            if (document.getElementById('footerCompany')) {
                document.getElementById('footerCompany').textContent = (footerName || 'íšŒì‚¬ëª…') + ' Â© ' + year;
            }
            if (document.getElementById('footerYear')) {
                document.getElementById('footerYear').textContent = String(year);
            }
            
            // ë°œì£¼ì²˜ ì •ë³´
            document.getElementById('clientCompany').textContent = estimate.clientName || 'Acme Corp';
            if (document.getElementById('clientProject')) {
                document.getElementById('clientProject').textContent = estimate.projectName || estimate.project || '';
            }
            if (document.getElementById('clientWorkplaceAddress')) {
                document.getElementById('clientWorkplaceAddress').textContent = estimate.workplaceAddress || '';
            }
            
            // ì‹œê³µì—…ì²´ ì •ë³´ (íšŒì‚¬ ì •ë³´ ì‚¬ìš©)
            document.getElementById('contractorCompany').textContent = company.name || '';
            if (document.getElementById('contractorContact')) document.getElementById('contractorContact').textContent = company.representative || '';
            if (document.getElementById('contractorEmail')) document.getElementById('contractorEmail').textContent = company.email || '';
            if (document.getElementById('contractorPhone')) document.getElementById('contractorPhone').textContent = company.phone || '';
            
            // ê²¬ì  í•­ëª©
            if (estimate.items && Array.isArray(estimate.items)) {
                const tbody = document.getElementById('quotationItems');
                tbody.innerHTML = '';
                
                estimate.items.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 dark:hover:bg-gray-800/50';
                    const unitPriceInThousands = Math.round((item.unitPrice || 0) / 1000);
                    const totalInThousands = Math.round((item.total || item.quantity * item.unitPrice || 0) / 1000);
                    row.innerHTML = `
                        <td class="p-2 text-center">${index + 1}</td>
                        <td class="p-2 text-center font-medium">${item.category || 'ê¸°íƒ€ê³µì‚¬'}</td>
                        <td class="p-2">${item.description || ''}</td>
                        <td class="p-2 text-center">${item.quantity || 1}</td>
                        <td class="p-2 text-center">${item.unit || 'ì‹'}</td>
                        <td class="p-2 text-right font-mono">${unitPriceInThousands.toLocaleString()}</td>
                        <td class="p-2 text-right font-mono font-medium text-primary">${totalInThousands.toLocaleString()}</td>
                        <td class="p-2 text-center text-xs text-gray-500 dark:text-gray-400">${item.notes || ''}</td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            // ê¸ˆì•¡ ì •ë³´ (ì²œì› ë‹¨ìœ„ë¡œ ë³€í™˜)
            const totalAmount = estimate.totalAmount || 93500000;
            const subtotal = Math.round(totalAmount / 1.1);
            const vat = totalAmount - subtotal;
            
            // ì²œì› ë‹¨ìœ„ë¡œ ë³€í™˜
            // í‘œì‹œëŠ” ì› ë‹¨ìœ„(â‚© â€¦ ì›)
            const fmt = (n) => 'â‚©' + n.toLocaleString() + 'ì›';
            document.getElementById('subtotal').textContent = fmt(subtotal);
            document.getElementById('vat').textContent = fmt(vat);
            document.getElementById('totalAmount').textContent = fmt(totalAmount);
            
            // í•œê¸€ ê¸ˆì•¡ í‘œê¸° ì—…ë°ì´íŠ¸ (ì‹¤ì œ ê¸ˆì•¡ ê¸°ì¤€)
            const koreanAmount = numberToKoreanFullAmount(totalAmount);
            const koreanAmountElement = document.querySelector('.text-base.text-gray-500.dark\\:text-gray-400.text-right.mt-2');
            if (koreanAmountElement) {
                koreanAmountElement.textContent = koreanAmount;
            }
            
            // íŠ¹ì´ì‚¬í•­ ë° ì¡°ê±´ ì—…ë°ì´íŠ¸ (ì‹¤ì œ ì…ë ¥ëœ ë‚´ìš© ì‚¬ìš©)
            const specialConditionsElement = document.getElementById('specialConditions');
            
            console.log('specialConditionsElement:', specialConditionsElement);
            console.log('estimate.notes ì¡´ì¬ ì—¬ë¶€:', !!estimate.notes);
            console.log('estimate.notes ë‚´ìš©:', estimate.notes);
            
            if (specialConditionsElement) {
                if (estimate.notes && estimate.notes.trim() !== '') {
                    console.log('ì‚¬ìš©ì ì…ë ¥ íŠ¹ì´ì‚¬í•­ ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤');
                    
                    // ì‹¤ì œ ê²¬ì ì„œ ì‘ì„± ì‹œ ì…ë ¥í•œ íŠ¹ì´ì‚¬í•­ ë° ì¡°ê±´ ì‚¬ìš©
                    const conditions = estimate.notes.trim();
                    
                    // ì¤„ë°”ê¿ˆìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
                    const conditionsList = conditions.split('\n').filter(item => item.trim() !== '');
                    console.log('ë¶„ë¦¬ëœ ì¡°ê±´ë“¤:', conditionsList);
                    
                    if (conditionsList.length > 0) {
                        let conditionsHTML = '<ul class="list-disc list-inside space-y-1">';
                        conditionsList.forEach(condition => {
                            const trimmedCondition = condition.trim();
                            if (trimmedCondition.startsWith('-')) {
                                // ì´ë¯¸ "-"ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë˜ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì ìš©
                                conditionsHTML += `<li>${trimmedCondition.substring(1).trim()}</li>`;
                            } else {
                                // ì¼ë°˜ í…ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œìœ¼ë¡œ ì‚¬ìš©
                                conditionsHTML += `<li>${trimmedCondition}</li>`;
                            }
                        });
                        conditionsHTML += '</ul>';
                        console.log('ìƒì„±ëœ ì‚¬ìš©ì ì¡°ê±´ HTML:', conditionsHTML);
                        specialConditionsElement.innerHTML = conditionsHTML;
                    } else {
                        // ì…ë ¥ëœ ë‚´ìš©ì´ ìˆì§€ë§Œ ì¤„ë°”ê¿ˆì´ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ í…ìŠ¤íŠ¸ë¡œ í‘œì‹œ
                        specialConditionsElement.innerHTML = `<p>${conditions}</p>`;
                    }
                } else {
                    console.log('ì‚¬ìš©ì ì…ë ¥ íŠ¹ì´ì‚¬í•­ì´ ì—†ì–´ ê¸°ë³¸ ì¡°ê±´ì„ í‘œì‹œí•©ë‹ˆë‹¤');
                    
                    // ì…ë ¥ëœ íŠ¹ì´ì‚¬í•­ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ì¡°ê±´ë“¤ì„ í‘œì‹œ
                    const defaultConditions = `
                        <ul class="list-disc list-inside space-y-1">
                            <li>ìƒê¸° ê¸ˆì•¡ì€ ë¶€ê°€ì„¸ê°€ í¬í•¨ëœ ê¸ˆì•¡ì…ë‹ˆë‹¤</li>
                            <li>ë³¸ ê²¬ì ì„œì˜ ìœ íš¨ê¸°ê°„ì€ ê²¬ì ì¼ë¡œë¶€í„° 30ì¼ì…ë‹ˆë‹¤</li>
                            <li>ê³„ì•½ì¡°ê±´: ê³„ì•½ê¸ˆ 30%, ì¤‘ë„ê¸ˆ 40%, ì”ê¸ˆ 30%</li>
                            <li>ê³µì‚¬ ì¤‘ ì„¤ê³„ë³€ê²½ ì‹œ ë³„ë„ í˜‘ì˜í•˜ì—¬ ì •ì‚°í•©ë‹ˆë‹¤</li>
                            <li>ìì¬ë¹„ ê¸‰ë“± ì‹œ(10% ì´ìƒ) ì‹¤ë¹„ ì •ì‚° ì›ì¹™</li>
                            <li>ì²œì¬ì§€ë³€ ë° ë¶ˆê°€í•­ë ¥ìœ¼ë¡œ ì¸í•œ ê³µê¸°ì§€ì—° ì‹œ í˜‘ì˜ì¡°ì •</li>
                            <li>ê´€ë ¨ ì¸í—ˆê°€ ë° ì‹ ê³ ì—…ë¬´ëŠ” ë°œì£¼ì²˜ì—ì„œ ì²˜ë¦¬</li>
                            <li>íê¸°ë¬¼ ì²˜ë¦¬ë¹„ ë° ì²­ì†Œë¹„ëŠ” ê²¬ì ê¸ˆì•¡ì— í¬í•¨</li>
                            <li>í•˜ìë‹´ë³´ì±…ì„: ê±´ì¶•ë²•ë ¹ì— ì˜ê±°í•˜ì—¬ 2ë…„ê°„</li>
                            <li>ê¸°íƒ€ ëª…ì‹œë˜ì§€ ì•Šì€ ì‚¬í•­ì€ ê±´ì„¤ì‚°ì—…ê¸°ë³¸ë²•ì„ ë”°ë¦„</li>
                        </ul>
                    `;
                    specialConditionsElement.innerHTML = defaultConditions;
                }
            }
        }
        
        // í˜ì´ì§€ ë¡œë”© ì‹œ URL íŒŒë¼ë¯¸í„°ì—ì„œ ë°ì´í„° ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            loadQuotationFromUrl();
        });
        
        // ìˆ«ì í¬ë§·íŒ… í•¨ìˆ˜
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // ìˆ«ìë¥¼ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (ì²œì› ë‹¨ìœ„)
        function numberToKorean(num) {
            const units = ['', 'ì‹­', 'ë°±', 'ì²œ', 'ë§Œ', 'ì‹­ë§Œ', 'ë°±ë§Œ', 'ì²œë§Œ', 'ì–µ'];
            const numbers = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
            
            if (num === 0) return 'ì˜ì›ì •';
            
            let result = '';
            let unitIndex = 0;
            
            while (num > 0) {
                const digit = num % 10;
                if (digit !== 0) {
                    if (unitIndex === 4 && digit === 1) { // ë§Œì˜ ìë¦¬ì—ì„œ 1ì€ ìƒëµ
                        result = units[unitIndex] + result;
                    } else if (digit === 1 && unitIndex > 0 && unitIndex < 4) { // ì‹­, ë°±, ì²œì˜ ìë¦¬ì—ì„œ 1ì€ ìƒëµ
                        result = units[unitIndex] + result;
                    } else {
                        result = numbers[digit] + units[unitIndex] + result;
                    }
                }
                num = Math.floor(num / 10);
                unitIndex++;
            }
            
            return '(' + result + 'ì›ì •)';
        }
        
        // ì‹¤ì œ ì› ê¸ˆì•¡ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
        function numberToKoreanFullAmount(num) {
            const units = ['', 'ì‹­', 'ë°±', 'ì²œ', 'ë§Œ', 'ì‹­ë§Œ', 'ë°±ë§Œ', 'ì²œë§Œ', 'ì–µ', 'ì‹­ì–µ', 'ë°±ì–µ', 'ì²œì–µ', 'ì¡°'];
            const numbers = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];
            
            if (num === 0) return '(ì˜ì›ì •)';
            
            let result = '';
            let unitIndex = 0;
            
            while (num > 0) {
                const digit = num % 10;
                if (digit !== 0) {
                    if (unitIndex === 4 && digit === 1) { // ë§Œì˜ ìë¦¬ì—ì„œ 1ì€ ìƒëµ
                        result = units[unitIndex] + result;
                    } else if (digit === 1 && unitIndex > 0 && unitIndex < 4) { // ì‹­, ë°±, ì²œì˜ ìë¦¬ì—ì„œ 1ì€ ìƒëµ
                        result = units[unitIndex] + result;
                    } else {
                        result = numbers[digit] + units[unitIndex] + result;
                    }
                }
                num = Math.floor(num / 10);
                unitIndex++;
            }
            
            return '(' + result + 'ì›ì •)';
        }
        
        // ê°œì„ ëœ ì¸ì‡„ í•¨ìˆ˜
        function handlePrint() {
            // ì¸ì‡„ ì „ í˜ì´ì§€ ìµœì í™”
            const originalTitle = document.title;
            document.title = 'ê²¬ì ì„œ_' + (document.getElementById('quotationId')?.textContent || 'Q2024-00123');
            
            // ì¸ì‡„ ì‹¤í–‰
            window.print();
            
            // ì¸ì‡„ í›„ ì›ë˜ ì œëª© ë³µì›
            setTimeout(() => {
                document.title = originalTitle;
            }, 1000);
        }
        
        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì› (Ctrl+P)
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                handlePrint();
            }
        });
        
        // ì¸ì‡„ ì „í›„ ì´ë²¤íŠ¸ ì²˜ë¦¬
        window.addEventListener('beforeprint', function() {
            document.body.classList.add('print-mode');
            console.log('ì¸ì‡„ ì‹œì‘');
        });
        
        window.addEventListener('afterprint', function() {
            document.body.classList.remove('print-mode');
            console.log('ì¸ì‡„ ì™„ë£Œ');
        });
    </script>
</body>
</html>
