"use strict";(self.webpackChunkconstruction_management_frontend=self.webpackChunkconstruction_management_frontend||[]).push([[288],{1288:(t,e,r)=>{r.d(e,{UV:()=>S,loadStampImage:()=>h,V6:()=>b,cF:()=>g});var n=r(5644);const a="handles",o="dirHandle";function c(){return"undefined"!==typeof window&&"showDirectoryPicker"in window}function i(){return new Promise((t,e)=>{const r=indexedDB.open("cms-fs",1);r.onupgradeneeded=()=>{const t=r.result;t.objectStoreNames.contains(a)||t.createObjectStore(a)},r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)})}async function s(){if(!c())return null;try{const t=await async function(t){const e=await i();return new Promise((r,n)=>{const o=e.transaction(a,"readonly").objectStore(a).get(t);o.onsuccess=()=>{var t;return r(null!==(t=o.result)&&void 0!==t?t:null)},o.onerror=()=>n(o.error)})}(o);return null!==t&&void 0!==t?t:null}catch(t){return null}}async function u(t){if(!c())return!1;try{return await async function(t,e){const r=await i();return new Promise((n,o)=>{const c=r.transaction(a,"readwrite").objectStore(a).put(e,t);c.onsuccess=()=>n(),c.onerror=()=>o(c.error)})}(o,t),!0}catch(e){return!1}}async function l(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"readwrite";return null!=t&&("granted"===await t.queryPermission({mode:e})||"granted"===await t.requestPermission({mode:e}))}async function w(t,e){return await t.getFileHandle(e,{create:!0})}async function d(t,e,r){try{if(null==t&&(t=await s()),null==t)return!1;if(!await l(t,"readwrite"))return!1;const n=await w(t,"".concat(e,".json")),a=await n.createWritable(),o=2;return await a.write(new Blob([JSON.stringify(r,null,o)],{type:"application/json"})),await a.close(),!0}catch(n){return!1}}const y={isSupported:c,getSavedDirectoryHandle:s,saveDirectoryHandle:u,chooseDirectory:async function(){if(!c())return null;try{if("function"!==typeof window.showDirectoryPicker)return null;const t=await window.showDirectoryPicker({id:"cms-data"});return await l(t,"readwrite")?(await u(t),t):null}catch(t){return null}},readKey:async function(t,e){try{if(null==t&&(t=await s()),null==t||null==e||""===e)return null;if(!await l(t,"read"))return null;const r=await w(t,"".concat(e,".json")),n=await r.getFile(),a=await n.text();return 0===a.length?null:JSON.parse(a)}catch(r){return null}},writeKey:d,writeKeyDirect:async function(t,e){const r=await s();return null!=r&&await d(r,t,e)},writeImageFile:async function(t,e){try{const r=await s();if(null==r)return!1;if(!await l(r,"readwrite"))return!1;const n=await r.getFileHandle(t,{create:!0}),a=await n.createWritable();return await a.write(e),await a.close(),!0}catch(r){return!1}}},f="stampImages",m="companyStamp",p=()=>new Promise((t,e)=>{const r=indexedDB.open("ConstructionAppDB",1);r.onerror=()=>e(r.error),r.onsuccess=()=>t(r.result),r.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(f)||e.createObjectStore(f)}}),g=async t=>{try{const r=await fetch(t),a=await r.blob(),o=5*n.nH*n.nH;if(a.size>o)return!1;const c=await p(),i=c.transaction([f],"readwrite").objectStore(f);if(await new Promise((t,e)=>{const r=i.put(a,m);r.onsuccess=()=>t(),r.onerror=()=>e(r.error)}),c.close(),y.isSupported())try{await y.writeImageFile("company-stamp.png",a)}catch(e){}return!0}catch(r){return!1}},h=async()=>{try{const t=await p(),e=t.transaction([f],"readonly").objectStore(f),r=await new Promise((t,r)=>{const n=e.get(m);n.onsuccess=()=>{const e=n.result;t(void 0!==e&&null!==e?e:null)},n.onerror=()=>r(n.error)});return t.close(),null===r?null:new Promise((t,e)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=()=>e(n.error),n.readAsDataURL(r)})}catch(t){return null}},b=async()=>{try{const t=await p(),e=t.transaction([f],"readwrite").objectStore(f);return await new Promise((t,r)=>{const n=e.delete(m);n.onsuccess=()=>t(),n.onerror=()=>r(n.error)}),t.close(),!0}catch(t){return!1}},S=t=>new Promise((e,r)=>{const n=new FileReader;n.onload=t=>{var n;const a=null===(n=t.target)||void 0===n?void 0:n.result;"string"===typeof a?e(a):r(new Error("Failed to convert file to base64"))},n.onerror=t=>r(t),n.readAsDataURL(t)})}}]);
//# sourceMappingURL=288.62c9b4b6.chunk.js.map