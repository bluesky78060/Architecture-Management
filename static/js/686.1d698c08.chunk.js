"use strict";(self.webpackChunkconstruction_management_frontend=self.webpackChunkconstruction_management_frontend||[]).push([[686],{6686:(t,n,e)=>{e.d(n,{autoMigrate:()=>S});var r=e(5471),o=e(7048);const c="CMS_2024_SECURE_KEY",l=5,u=4294967295,a=36;function i(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<l)-n+t.charCodeAt(e)&u;return n.toString(a)}function s(t){return["CMS_USERS","CURRENT_USER","CMS_DISABLE_LOGIN","CMS_LOGOUT","constructionApp_stampImage"].some(n=>t.includes(n))}function g(t){try{if("undefined"===typeof window||null==window.localStorage)return null;const e=window.localStorage.getItem(t);if(null===e)return null;if(!1===s(t))return e;try{const t=JSON.parse(e);if(null==t.encrypted||null==t.checksum)return e;const n=function(t,n){try{const e=atob(t);let r="";for(let t=0;t<e.length;t++)r+=String.fromCharCode(e.charCodeAt(t)^n.charCodeAt(t%n.length));return r}catch(e){return null}}(t.encrypted,c);if(null===n)return null;return i(n)!==t.checksum?null:n}catch(n){return e}}catch(e){return null}}const f=["CMS_USERS","CURRENT_USER","CMS_DISABLE_LOGIN","CMS_LOGOUT","constructionApp_stampImage"];function d(t){try{const n=JSON.parse(t);return null!=n.encrypted&&null!=n.checksum&&null==n.iv&&null==n.algorithm}catch(n){return!1}}function y(t){try{const n=JSON.parse(t);return null!=n.encrypted&&null!=n.iv&&null!=n.algorithm}catch(n){return!1}}async function h(t){try{if("undefined"===typeof window||null==window.localStorage)throw new Error("localStorage\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");const n=window.localStorage.getItem(t);if(null===n)return!1;if(y(n))return r.v.log("[Migration] ".concat(t,": \uc774\ubbf8 \uc2e0\ubc84\uc804 \uc554\ud638\ud654 - \uc2a4\ud0b5")),!0;if(!d(n))return r.v.log("[Migration] ".concat(t,": \uad6c\ubc84\uc804 \uc554\ud638\ud654 \uc544\ub2d8 - \uc2a4\ud0b5")),!0;r.v.log("[Migration] ".concat(t,": \uad6c\ubc84\uc804 \uac10\uc9c0, \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2dc\uc791..."));const e=g(t);if(null===e||""===e)throw new Error("\uad6c\ubc84\uc804 \ubcf5\ud638\ud654 \uc2e4\ud328");return r.v.log("[Migration] ".concat(t,": \uad6c\ubc84\uc804 \ubcf5\ud638\ud654 \uc131\uacf5 (").concat(e.length," bytes)")),await o.Z.setSecureItem(t,e),r.v.log("[Migration] ".concat(t,": \uc2e0\ubc84\uc804 \uc554\ud638\ud654 \ubc0f \uc800\uc7a5 \uc644\ub8cc \u2713")),!0}catch(n){return r.v.error("[Migration] ".concat(t," \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2e4\ud328:"),n),!1}}async function S(t){try{const n=function(){const t={};if("undefined"===typeof window||null==window.localStorage)return t;for(const n of f){const e=window.localStorage.getItem(n);null===e?t[n]="\ub370\uc774\ud130 \uc5c6\uc74c":y(e)?t[n]="v2 (AES-256-GCM) \u2713":d(e)?t[n]="v1 (XOR) - \ub9c8\uc774\uadf8\ub808\uc774\uc158 \ud544\uc694 \u26a0\ufe0f":t[n]="\uc54c \uc218 \uc5c6\ub294 \ud615\uc2dd"}return t}();if(!Object.values(n).some(t=>t.includes("v1")))return void r.v.log("\u2713 \ubaa8\ub4e0 \ub370\uc774\ud130\uac00 \uc774\ubbf8 \ucd5c\uc2e0 \uc554\ud638\ud654 \ud615\uc2dd\uc785\ub2c8\ub2e4.");r.v.log("\u26a0\ufe0f \uad6c\ubc84\uc804 \uc554\ud638\ud654 \uac10\uc9c0 - \uc790\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2dc\uc791");const e=await async function(t){r.v.log("=== \ubcf4\uc548 \uc2dc\uc2a4\ud15c \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2dc\uc791 ==="),r.v.log("\ub300\uc0c1 \ud0a4: ".concat(f.length,"\uac1c"));try{await o.Z.initializeSystemKey(t),r.v.log("\uc2dc\uc2a4\ud15c \ubcf4\uc548 \ud0a4 \ucd08\uae30\ud654 \uc644\ub8cc \u2713")}catch(e){return r.v.error("\uc2dc\uc2a4\ud15c \ud0a4 \ucd08\uae30\ud654 \uc2e4\ud328:",e),{success:!1,migratedKeys:[],failedKeys:f,skippedKeys:[],errors:[{key:"SYSTEM",error:String(e)}]}}const n={success:!0,migratedKeys:[],failedKeys:[],skippedKeys:[],errors:[]};for(const r of f)try{if(await h(r)){const t=window.localStorage.getItem(r);null!==t&&y(t)?n.migratedKeys.push(r):n.skippedKeys.push(r)}else n.failedKeys.push(r),n.errors.push({key:r,error:"\ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2e4\ud328"})}catch(e){n.failedKeys.push(r),n.errors.push({key:r,error:String(e)}),n.success=!1}return r.v.log("=== \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc644\ub8cc ==="),r.v.log("\uc131\uacf5: ".concat(n.migratedKeys.length,"\uac1c")),r.v.log("\uc2a4\ud0b5: ".concat(n.skippedKeys.length,"\uac1c")),r.v.log("\uc2e4\ud328: ".concat(n.failedKeys.length,"\uac1c")),n}(t);e.success&&0===e.failedKeys.length?r.v.log("\u2713 \uc790\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc644\ub8cc"):r.v.error("\u26a0\ufe0f \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc911 \uc77c\ubd80 \uc624\ub958 \ubc1c\uc0dd:",e)}catch(n){r.v.error("\uc790\ub3d9 \ub9c8\uc774\uadf8\ub808\uc774\uc158 \uc2e4\ud328:",n)}}}}]);
//# sourceMappingURL=686.1d698c08.chunk.js.map