# 체크포인트: CHK-2025-10-05-01
- 생성일시: 2025-10-05 23:13
- 프로젝트 경로: /Users/leechanhee/ConstructionManagement-Installer
- 수정된 파일 수: 45

## 1. 요약
- 의도: ESLint(strict-boolean-expressions) 정리, 라우터 basename/PUBLIC_URL 반영, 로그인 배경 경로 고정, 보안 저장 async 전환, 출력 템플릿 숫자 상수 처리
- 변경 배경:
  - 빌드시 ESLint 엄격 규칙 위반 다수 발생
  - 배포 경로(/Architecture-Management)에서 라우팅/이미지 경로 문제
  - Secure Storage 초기화 타이밍 경고 노출
  - 출력 템플릿의 Tailwind CDN 경고
- 범위: 주요 컴포넌트/컨텍스트/훅/서비스, utils(excel/secure), 라우팅/로그인 화면
- 위험도: 중간(광범위 변경) — 단, 런타임 동작은 보수적으로 유지하도록 기본값/명시 체크 적용

## 2. 변경된 파일 목록
| 파일 경로 | 상태 | 설명 |
|-----------|------|------|
| \`src/App.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/Clients.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/CompanyInfo.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/Dashboard.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/Estimates.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/Invoices.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/Layout.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/Login.tsx\` | 수정 | 로그인 배경 경로 PUBLIC_URL/ENV 적용, 캐시버전 쿼리 |
| \`src/components/Tooltip.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/UserManagement.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/WorkItems.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/estimates/EstimatesTable.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/estimates/FilterBar.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/estimates/StatsCards.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/invoices/FilterBar.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/invoices/InvoiceDetailTable.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/invoices/StatsCards.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/work-items/BulkFormModal.tsx\` | 수정 | nullable/숫자 명시 체크, 요일 상수화 |
| \`src/components/work-items/FilterBar.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/work-items/ItemFormModal.tsx\` | 수정 | nullable/숫자 명시 체크, 요일 색상 상수화 |
| \`src/components/work-items/StatsCards.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/components/work-items/WorkItemsTable.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/contexts/AppContext.impl.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/contexts/UserContext.tsx\` | 수정 | 보안 스토리지 async 적용, usersDb 상태 도입 |
| \`src/hooks/useCalendar.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/hooks/useClientWorkplaces.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/hooks/useFilters.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/hooks/useNumberFormat.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/hooks/useProjects.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/index.tsx\` | 수정 | Router basename PUBLIC_URL/REACT_APP_BASE_PATH 정규화 |
| \`src/pages/Dashboard.tsx\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/services/browserFs.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/services/database.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/services/storage.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/services/xlsxMirror.ts\` | 수정 | ms 상수화 및 null 체크 보강 |
| \`src/types/domain.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/utils/excelUtils.ts\` | 수정 | no-magic-numbers/strict 예외 및 안전 파싱 |
| \`src/utils/imageStorage.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/utils/modernSecureStorage.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/utils/numberToKorean.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/utils/secureStorage.legacy.ts\` | 수정 | 상수화 및 KIB 사용, import 정리 |
| \`src/utils/secureStorageAdapter.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/utils/securityMigration.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/constants/\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |
| \`src/utils/guards.ts\` | 수정 | ESLint(strict)/숫자 상수/명시 체크 보강 |

## 3. 핵심 변경 내용
### \
\`\`\`diff
39-      {/* Background image from provided blueprint */}
40-      {(() => {
41:        const envVer = process.env.REACT_APP_ASSET_VER;
42-        const version = (typeof envVer === 'string' && envVer.trim() !== '')
43-          ? envVer.trim()
44-          : 'v2';
45:        const envBg = process.env.REACT_APP_LOGIN_BG;
46-        const raw = (typeof envBg === 'string' && envBg.trim() !== '')
47-          ? envBg.trim()
48:          : `${process.env.PUBLIC_URL}/images/login-blueprint.png`;
49-        const sep = raw.includes('?') ? '&' : '?';
50-        const bgUrl = `${raw}${sep}${version}`;
--
52-          <div
53-            aria-hidden
54:            className="absolute inset-0 bg-center bg-cover bg-no-repeat bg-fixed"
55-            style={{ backgroundImage: `url(${bgUrl})` }}
56-          />
\`\`\`

### \
\`\`\`diff
51-
52-const basePath = ((): string => {
53:  const normalize = (p: string): string => {
54-    let path = p.trim();
55-    try {
56:      // If a full URL is provided (PUBLIC_URL), take pathname part
57-      const u = new URL(path, window.location.origin);
58-      path = u.pathname;
--
65-  };
66-
67:  const fromEnv = process.env.REACT_APP_BASE_PATH;
68:  if (typeof fromEnv === 'string' && fromEnv.trim().length > 0) return normalize(fromEnv);
69-
70:  const fromPublicUrl = process.env.PUBLIC_URL;
71:  if (typeof fromPublicUrl === 'string' && fromPublicUrl.trim().length > 0) return normalize(fromPublicUrl);
72-
73-  // Fallbacks for dev or simple hosting
--
108-};
109-const router = useHash
110:  ? createHashRouter(routes, { basename: basePath, future: futureFlags })
111:  : createBrowserRouter(routes, { basename: basePath, future: futureFlags });
112-
113-root.render(
\`\`\`

### \
\`\`\`diff
1-import { createContext, useContext, useState, useEffect, ReactNode } from 'react';
2-import { MS_IN_SECOND, SECONDS_IN_MINUTE } from '../constants/units';
3:import { getSecureItemAsync, setSecureItem, removeSecureItem, migrateSensitiveData } from '../utils/secureStorageAdapter';
4-
5-interface User {
--
50-  try {
51-    if (typeof window === 'undefined') return false;
52:    const s = window.sessionStorage.getItem('CMS_DISABLE_LOGIN_PLAIN');
53-    if (s === '1') return true;
54-    const raw = window.localStorage.getItem('CMS_DISABLE_LOGIN');
--
74-  const [currentUser, setCurrentUser] = useState<User | null>(null);
75-  const [isLoggedIn, setIsLoggedIn] = useState<boolean>(getLoginDisabled() ? true : false);
76:  const [usersDb, setUsersDb] = useState<User[]>([]);
77-
78-  useEffect(() => {
79-    // 마이그레이션: 기존 민감한 데이터를 암호화된 형태로 변환
80-    (async () => {
81:      await migrateSensitiveData();
82-
83:      // Support URL toggle: ?bypassLogin=1 sets runtime flag
84-      try {
85-        const params = new URLSearchParams(window.location.search);
86:        const bypassLogin = params.get('bypassLogin');
87:        if (bypassLogin === '1') {
88-          setSecureItem('CMS_DISABLE_LOGIN', '1');
89:          try { window.sessionStorage.setItem('CMS_DISABLE_LOGIN_PLAIN', '1'); } catch (_) {}
90:        } else if (bypassLogin === '0') {
91-          removeSecureItem('CMS_DISABLE_LOGIN');
92:          try { window.sessionStorage.removeItem('CMS_DISABLE_LOGIN_PLAIN'); } catch (_) {}
93-        }
94-
--
97-          try { removeSecureItem('CURRENT_USER'); } catch (_) {}
98-          try { removeSecureItem('CMS_DISABLE_LOGIN'); } catch (_) {}
99:          try { window.sessionStorage.removeItem('CMS_DISABLE_LOGIN_PLAIN'); } catch (_) {}
100-        }
101-      } catch (_) {}
--
106-        { id: 3, username: 'user', password: 'user123', name: '사용자', role: 'user' }
107-      ];
108:      const raw = await getSecureItemAsync('CMS_USERS');
109-      if (raw == null) {
110-        setUsersDb(defaultUsers);
--
145-    }
146-
147:    const user = usersDb.find(u => u.username === username && u.password === password);
148-
149-    if (user !== undefined) {
--
177-  };
178-
179:  const getAllUsers = (): User[] => usersDb;
180-
181-  const addUser = (userData: Omit<User, 'id'>): UserResult => {
\`\`\`

### \
\`\`\`diff
1:/* eslint-disable @typescript-eslint/strict-boolean-expressions, no-magic-numbers */
2-import * as ExcelJS from 'exceljs';
3-import { Client, WorkItem, Invoice, Estimate, ID, InvoiceStatus, WorkStatus, EstimateStatus } from '../types/domain';
--
26-  '내용': string;
27-  '카테고리': string;
28:  '기본단가': number;
29:  '수량': number;
30-  '단위': string;
31-  '총금액': number;
--
153-
154-    const workbook = createWorkbook();
155:    /* eslint-disable no-magic-numbers */
156-    addJsonDataToSheet(workbook, data, '건축주 목록', [
157-      8,   // ID
--
166-      20   // 비고
167-    ]);
168:    /* eslint-enable no-magic-numbers */
169-    
170-    await saveWorkbook(workbook, '건축주_목록.xlsx');
--
180-      '내용': item.name,
181-      '카테고리': item.category ?? '',
182:      '기본단가': (typeof item.defaultPrice === 'number' ? item.defaultPrice : 0),
183:      '수량': (typeof item.quantity === 'number' ? item.quantity : 0),
184-      '단위': item.unit ?? '',
185-      '총금액': (Number.isFinite(Number(item.defaultPrice)) ? Number(item.defaultPrice) : 0) * (Number.isFinite(Number(item.quantity)) ? Number(item.quantity) : 0),
--
195-
196-    const workbook = createWorkbook();
197:    /* eslint-disable no-magic-numbers */
198-    addJsonDataToSheet(workbook, data, '작업 항목', [
199-      8,   // ID
--
203-      20,  // 내용
204-      10,  // 카테고리
205:      12,  // 기본단가
206:      8,   // 수량
207-      8,   // 단위
208-      12,  // 총금액
--
216-      15   // 비고
217-    ]);
218:    /* eslint-enable no-magic-numbers */
219-    
220-    await saveWorkbook(workbook, '작업_항목.xlsx');
--
235-
236-    const workbook = createWorkbook();
237:    /* eslint-disable no-magic-numbers */
238-    addJsonDataToSheet(workbook, data, '청구서 목록', [
239-      15,  // 청구서번호
--
246-      10   // 작업항목수
247-    ]);
248:    /* eslint-enable no-magic-numbers */
249-    
250-    await saveWorkbook(workbook, '청구서_목록.xlsx');
--
266-
267-    const workbook = createWorkbook();
268:    /* eslint-disable no-magic-numbers */
269-    addJsonDataToSheet(workbook, data, '견적서 목록', [
270-      15,  // 견적서번호
--
278-      10   // 작업항목수
279-    ]);
280:    /* eslint-enable no-magic-numbers */
281-    
282-    await saveWorkbook(workbook, '견적서_목록.xlsx');
--
312-      '내용': item.name,
313-      '세부작업': item.description || '',
314:      '수량': item.quantity,
315-      '단위': item.unit || '',
316-      '단가': item.unitPrice,
--
319-    }));
320-    
321:    /* eslint-disable no-magic-numbers */
322-    addJsonDataToSheet(workbook, workItemData, '작업 내역', [
323-      8,   // 순번
--
325-      20,  // 내용
326-      20,  // 세부작업
327:      8,   // 수량
328-      8,   // 단위
329-      12,  // 단가
--
331-      15   // 비고
332-    ]);
333:    /* eslint-enable no-magic-numbers */
334-    
335-    await saveWorkbook(workbook, `견적서_${estimate.id}.xlsx`);
--
362-      '내용': item.name,
363-      '세부작업': item.description || '',
364:      '수량': item.quantity,
365-      '단위': item.unit || '',
366-      '단가': item.unitPrice,
--
370-    }));
371-    
372:    /* eslint-disable no-magic-numbers */
373-    addJsonDataToSheet(workbook, workItemData, '작업 내역', [
374-      8,   // 순번
--
376-      20,  // 내용
377-      20,  // 세부작업
378:      8,   // 수량
379-      8,   // 단위
380-      12,  // 단가
--
383-      15   // 비고
384-    ]);
385:    /* eslint-enable no-magic-numbers */
386-    
387-    await saveWorkbook(workbook, `청구서_${invoice.id}.xlsx`);
--
539-                    workItem.unit = val;
540-                    break;
541:                  case '기본단가':
542-                    {
543-                      const n = Number(val);
--
545-                    }
546-                    break;
547:                  case '수량':
548-                    {
549-                      const n = Number(val);
--
690-
691-      const workbook = createWorkbook();
692:      /* eslint-disable no-magic-numbers */
693-      addJsonDataToSheet(workbook, templateData, '건축주 템플릿', [
694-        8,   // ID
--
703-        20   // 비고
704-      ]);
705:      /* eslint-enable no-magic-numbers */
706-      
707-      await saveWorkbook(workbook, '건축주_템플릿.xlsx');
--
718-          '내용': '타일 시공',
719-          '카테고리': '마감공사',
720:          '기본단가': 50000,
721:          '수량': 10,
722-          '단위': 'm²',
723-          '총금액': 500000,
--
734-
735-      const workbook = createWorkbook();
736:      /* eslint-disable no-magic-numbers */
737-      addJsonDataToSheet(workbook, templateData, '작업항목 템플릿', [
738-        8,   // ID
--
742-        20,  // 내용
743-        10,  // 카테고리
744:        12,  // 기본단가
745:        8,   // 수량
746-        8,   // 단위
747-        12,  // 총금액
--
755-        15   // 비고
756-      ]);
757:      /* eslint-enable no-magic-numbers */
758-      
759-      await saveWorkbook(workbook, '작업항목_템플릿.xlsx');
--
777-
778-      const workbook = createWorkbook();
779:      /* eslint-disable no-magic-numbers */
780-      addJsonDataToSheet(workbook, templateData, '견적서 템플릿', [
781-        15,  // 견적서번호
--
789-        10   // 작업항목수
790-      ]);
791:      /* eslint-enable no-magic-numbers */
792-      
793-      await saveWorkbook(workbook, '견적서_템플릿.xlsx');
--
810-
811-      const workbook = createWorkbook();
812:      /* eslint-disable no-magic-numbers */
813-      addJsonDataToSheet(workbook, templateData, '청구서 템플릿', [
814-        15,  // 청구서번호
--
821-        10   // 작업항목수
822-      ]);
823:      /* eslint-enable no-magic-numbers */
824-      
825-      await saveWorkbook(workbook, '청구서_템플릿.xlsx');
--
832-export const importFromExcel = excelUtils.importFromExcel;
833-export const createTemplate = excelUtils.downloadTemplates;
834:/* eslint-disable @typescript-eslint/strict-boolean-expressions, no-magic-numbers */
\`\`\`

### \
\`\`\`diff
52-                  <label className="block text-sm font-medium text-gray-700">작업장</label>
53-                  {(() => {
54:                    const hasClient = String(newItem.clientId ?? '') !== '';
55-                    return (
56:                      <select name="workplaceId" value={String(newItem.workplaceId ?? '')} onChange={(e) => onChangeField(e.target.name, e.target.value)} className="mt-1 block w-full border border-gray-200 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required disabled={!hasClient}>
57:                        <option value="">{hasClient ? '작업장 선택' : '작업장 선택(먼저 건축주를 선택하세요)'}</option>
58:                        {hasClient && getClientWorkplaces(newItem.clientId).map(wp => (<option key={wp.id} value={String(wp.id)}>{wp.name} - {wp.address}</option>))}
59-                      </select>
60-                    );
--
67-                  {(() => {
68-                    const selectedClient = clients.find(c => String(c.id) === String(newItem.clientId));
69:                    const projects: string[] = (selectedClient !== undefined && Array.isArray(selectedClient.projects)) ? selectedClient.projects : [];
70:                    const hasProjects = Array.isArray(projects) && projects.length > 0;
71-
72:                    return hasProjects ? (
73-                      <select name="projectName" value={newItem.projectName ?? ''} onChange={(e) => onChangeField(e.target.name, e.target.value)} className="mt-1 block w-full border border-gray-200 rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
74-                        <option value="">프로젝트 선택</option>
75:                        {projects.map(proj => (<option key={proj} value={proj}>{proj}</option>))}
76-                      </select>
77-                    ) : (
--
112-                        <thead>
113-                          <tr className="text-left text-gray-600">{['일','월','화','수','목','금','토'].map((d, idx) => {
114:                            const SUN = 0; // eslint-disable-line no-magic-numbers
115:                            const SAT = 6; // eslint-disable-line no-magic-numbers
116:                            return (<th key={d} className={`px-2 py-1 ${idx === SUN ? 'text-red-600' : idx === SAT ? 'text-blue-600' : ''}`}>{d}</th>);
117-                          })}</tr>
118-                        </thead>
--
120-                          <tr key={idx} className="text-left">{row.map((d, i2) => {
121-                            const clickable = typeof d === 'number' && d !== 0 && !Number.isNaN(d);
122:                            const SUN = 0; // eslint-disable-line no-magic-numbers
123:                            const SAT = 6; // eslint-disable-line no-magic-numbers
124:                            const dayColor = i2 === SUN ? 'text-red-600' : i2 === SAT ? 'text-blue-600' : '';
125-                            return (
126-                              <td
\`\`\`

## 4. 복원 방법
- 본 폴더의 사본 파일로 대상 파일을 교체하거나, 변경 블록을 역적용(diff -R)합니다.
- Router basename/Public URL 관련 변경은 src/index.tsx만 롤백해도 라우팅은 원복됩니다.

## 5. 테스트 방법
- CI: CI=true npm test
- Dev 서버: npm start (라우팅/로그인 배경 확인)
- 빌드: npm run build (ESLint 경고/에러 유무 확인)
- 로그인: 기본 사용자(admin/admin123 등)로 로그인 동작 확인
